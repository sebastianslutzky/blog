<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  
  
  <title>Delete Stale Git Branches With Powershell</title>
  <meta name="description" content="With the increasing adoption of source code management workflows such as Git Flow, it is common to keep &quot;stale&quot; branches in local repositories. Steps to reproduce The steps needed to end up in this situation are more or less like this: Dev1 creates &amp;amp; publishes the branch Feature1 git checkout -B Feature1 ..make &amp;amp; commit changes.. git push -u origin Feature1 Dev2 fetches the branch to collaborate or review git fetch git checkout Feature1 Dev2 deletes the Feature1 branch after merging it into master # delete the branch on the remote git push origin --delete Feature1 # delete the branch locally git branch -D Feature1 Pruning stale references At this stage, Dev1 (and 3, 4 etc) will want to have the deleted branch gone from their workspace too. A quick search will lead you to the prune sub command $&amp;gt; git remote update origin --prune Fetching origin From https://github.com/sebastianslutzky/TestRepo x [deleted] (none) -&amp;gt; origin/Feature1 However, this command only removes the reference to the tracking branch, not the local branch itself. You can see that the orphan branch is still here: $&amp;gt; git branch -l Feature1 * master Delete branches not in the remote So here is a simple Powershell script that deletes the orphan local branch: 1 2 3 4 5 6 7 $local=git branch -l $remote=git branch -r $local| %{$_.Trim()}| ?{-not ($remote -like &amp;#39;*&amp;#39; + $_) }| ?{-not($_ -match &amp;quot;master&amp;quot; )}| %{git branch -D $_} Surely this code could be compressed in one single piped command, but it could turn a bit confusing. We are getting the list of local and remote branches (lines 1 &amp;amp; 2). Then we perform a substraction set operation ($local - $remote) (line 5). This will gives us the set of local branches not in the remote local branches not in the remote. We finally delete them in line 7.">
  

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="http://youarewhatyoucode/2017/03/31/delete-stale-git-branches-with-powershell/">
  
  
  <link rel="alternate" type="application/rss+xml" title="you are what you code" href="http://youarewhatyoucode/feed.xml">
     <!-- favicon -->
    <link rel="shortcut icon" href="http://youarewhatyoucode/favicon.ico" type="image/icon"> 
    <link rel="icon" href="http://youarewhatyoucode/favicon.ico" type="image/icon">

    <!-- favicon -->
    <link rel="shortcut icon" href="favicon.ico" type="image/icon"> 
    <link rel="icon" href="favicon.ico" type="image/icon">

  
  <meta name="twitter:card" content="summary">
  
  <meta name="twitter:title" content="Delete Stale Git Branches With Powershell">
  <meta name="twitter:description" content="With the increasing adoption of source code management workflows such as Git Flow, it is common to keep &quot;stale&quot; branches in local repositories. Steps to reproduce The steps needed to end ...">
  
  

  <script type="text/javascript">
  WebFontConfig = {
    google: { families: [ 'Bitter:400,700,400italic:latin' ] }
  };
  (function() {
    var wf = document.createElement('script');
    wf.src = ('https:' == document.location.protocol ? 'https' : 'http') +
      '://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js';
    wf.type = 'text/javascript';
    wf.async = 'true';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(wf, s);
  })();
</script>

  

</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">you are what you code</a>

    <nav class="site-nav">
      
        
        <a class="page-link" href="https://ie.linkedin.com/in/sebastianslutzky">About</a>
      
        
        <a class="page-link" href="/archives/">Archives</a>
      
        
        <a class="page-link" href="https://github.com/sebastianslutzky">GitHub</a>
      
    </nav>

  </div>

</header>


    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    
      <h1 class="post-title" itemprop="name headline">Delete Stale Git Branches With Powershell</h1>
    
    <p class="post-meta">
      <time datetime="2017-03-31T00:00:00+00:00" itemprop="datePublished">Mar 31, 2017</time>
       
       â€¢ 
  
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <a href="/categories/git/">git</a>,
    
  

  
  
    
  
    
  
    
      <a href="/categories/powershell/">powershell</a>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

</p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <div class="paragraph">
<p>With the increasing adoption of source code management workflows such as <a href="http://nvie.com/posts/a-successful-git-branching-model/">Git Flow</a>,
it is common to keep "stale" branches in local repositories.</p>
</div>
<div class="sect1">
<h2 id="steps_to_reproduce">Steps to reproduce</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The steps needed to end up in this situation are more or less like this:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Dev1 creates &amp; publishes the branch Feature1</p>
<div class="literalblock">
<div class="content">
<pre>git checkout -B Feature1
..make &amp; commit changes..
git push -u origin Feature1</pre>
</div>
</div>
</li>
<li>
<p>Dev2 fetches the branch to collaborate or review</p>
<div class="literalblock">
<div class="content">
<pre>git fetch
git checkout Feature1</pre>
</div>
</div>
</li>
<li>
<p>Dev2 deletes the Feature1 branch after merging it into master</p>
<div class="literalblock">
<div class="content">
<pre># delete the branch on the remote
git push origin --delete Feature1
# delete the branch locally
git branch -D Feature1</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="pruning_stale_references">Pruning stale references</h2>
<div class="sectionbody">
<div class="paragraph">
<p>At this stage,  Dev1 (and 3, 4 etc) will want to have the deleted branch gone from their workspace too.</p>
</div>
<div class="paragraph">
<p>A quick search will lead you to the <code>prune</code> sub command</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$&gt; git remote update origin --prune
Fetching origin
From https://github.com/sebastianslutzky/TestRepo
x [deleted]         (none)     -&gt; origin/Feature1</pre>
</div>
</div>
<div class="paragraph">
<p>However, this command only removes the reference to the tracking branch, not the local branch itself.
You can see that the orphan branch is still here:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$&gt; git branch -l
 Feature1
 * master</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="delete_branches_not_in_the_remote">Delete branches not in the remote</h2>
<div class="sectionbody">
<div class="paragraph">
<p>So here is a simple Powershell script that deletes the orphan local branch:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="powershell"><table class="pyhltable"><tr><td><div class="linenodiv" style="background-color: #f0f0f0; padding-right: 10px">1
2
3
4
5
6
7</div></td><td class="code"><span></span> <span style="color: #19177C">$local</span>=git branch -l
 <span style="color: #19177C">$remote</span>=git branch -r
 <span style="color: #19177C">$local</span>|
    %{<span style="color: #19177C">$_</span>.Trim()}|
    ?{<span style="color: #666666">-not</span> (<span style="color: #19177C">$remote</span> <span style="color: #666666">-like</span> <span style="color: #BA2121">&#39;*&#39;</span> + <span style="color: #19177C">$_</span>) }|
    ?{<span style="color: #666666">-not</span>(<span style="color: #19177C">$_</span> <span style="color: #666666">-match</span> <span style="color: #BA2121">&quot;master&quot;</span> )}|
    %{git branch -D <span style="color: #19177C">$_</span>}
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Surely this code could be compressed in one single piped command, but it could turn a bit confusing.</p>
</div>
<div class="paragraph">
<p>We are getting the list of local and remote branches (lines 1 &amp; 2).
Then we perform a substraction set operation ($local - $remote) (line 5).
This will gives us the set of local branches not in the remote local branches not in the remote.</p>
</div>
<div class="paragraph">
<p>We finally delete them in line 7.</p>
</div>
</div>
</div>
  </div>

</article>

      </div>
    </main>

    <footer class="site-footer">

  <div class="wrapper">

    <p>
      

&copy; sebastian slutzky - Powered by <a href="https://jekyllrb.com">Jekyll</a> &amp; <a href="https://github.com/yous/whiteglass">whiteglass</a> - Subscribe via <a href="http://youarewhatyoucode/feed.xml">RSS</a>

    </p>

  </div>

</footer>


  </body>

</html>
