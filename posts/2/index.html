<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  
  
  <title>you are what you code</title>
  <meta name="description" content="a pretentiusly simple blog, with a series of coherent tech rambles...">
  

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="http://youarewhatyoucode/posts/2/">
  
  
  <link rel="alternate" type="application/rss+xml" title="you are what you code" href="http://youarewhatyoucode/feed.xml">
     <!-- favicon -->
    <link rel="shortcut icon" href="http://youarewhatyoucode/favicon.ico" type="image/icon"> 
    <link rel="icon" href="http://youarewhatyoucode/favicon.ico" type="image/icon">

    <!-- favicon -->
    <link rel="shortcut icon" href="http://youarewhatyoucode/favicon.ico?v=2" /> 
    <link rel="icon" href="http://youarewhatyoucode/favicon.ico?v=2" />
        <!-- Start of StatCounter Code -->
<div id="statcounter_image" style="display:inline;"><a
title="web statistics" href="http://statcounter.com/"
class="statcounter"><img
src="//c.statcounter.com/7145507/0/8d806d50/1/" alt="web
statistics" style="border:none;" /></a></div>
    <!-- End of StatCounter Code -->

  
  <meta name="twitter:card" content="summary">
  
  <meta name="twitter:title" content="you are what you code">
  <meta name="twitter:description" content="a pretentiusly simple blog, with a series of coherent tech rambles...">
  
  

  <script type="text/javascript">
  WebFontConfig = {
    google: { families: [ 'Bitter:400,700,400italic:latin' ] }
  };
  (function() {
    var wf = document.createElement('script');
    wf.src = ('https:' == document.location.protocol ? 'https' : 'http') +
      '://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js';
    wf.type = 'text/javascript';
    wf.async = 'true';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(wf, s);
  })();
</script>

  

</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">you are what you code</a>

    <nav class="site-nav">
      
        
        <a class="page-link" href="https://ie.linkedin.com/in/sebastianslutzky">About</a>
      
        
        <a class="page-link" href="/archives/">Archives</a>
      
        
        <a class="page-link" href="https://github.com/sebastianslutzky">GitHub</a>
      
    </nav>

  </div>

</header>


    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <div class="home">
  

  

  <ul class="post-list">
    
      
      

      <li>
        <header class="post-header">
          <h1 class="post-title">
            <a class="post-link" href="/2011/08/22/apply-operation-in-collection-with-linq/">Apply Operation In Collection With Linq</a>
          </h1>

          <p class="post-meta">Aug 22, 2011 • 
  
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <a href="/categories/linq/">linQ</a>,
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

  
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <a href="/categories/net/">.net</a>,
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

  
  
    
  
    
  
    
  
    
  
    
  
    
      <a href="/categories/c/">c#</a>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

</p>
        </header>

        <div class="post-content">
          <div class="paragraph">
<p>These days, it is unusual to write an implementation of the Iterator pattern. Most of the modern languages included a library with a set of aggregate objects that follow this pattern as defined in the <a href="https://www.amazon.com/Design-Patterns-Elements-Reusable-Object-Oriented/dp/0201633612">Gang of Four book</a>.</p>
</div>
<div class="paragraph">
<p>In .Net, these objects are in the System.Collections namespace and they include classes such as Lists, Queues, Dictionaries, and also their specialised strongly typed (Generic) version.</p>
</div>
<div class="paragraph">
<p>The Gang Of Four defines two types of iterators: External and Internal. The External requires the client to traverse the items (by looping through the items until the end of the iterator). In contrast to this, the internal iterator delegates this process to a Traverse mix-in class that can be extended and customised.</p>
</div>
<div class="paragraph">
<p>I was looking for something similar to the internal iterator in .Net. That is, a generic way of passing an operation to a collection that would apply it to each of its items. None of the LinQ extension methods for collections seemed to do this, so I wrote one:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight" style="background: #f8f8f8;"><code data-lang="csharp"><span></span><span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">static</span> <span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">Extensions</span>
{
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">static</span> <span style="color: #008000; font-weight: bold">void</span> ApplyOperation&lt;T&gt;
                (<span style="color: #008000; font-weight: bold">this</span> IEnumerable&lt;T&gt; iterator,
                Action&lt;T&gt; action)
    {
        <span style="color: #008000; font-weight: bold">foreach</span> (<span style="color: #B00040">var</span> item <span style="color: #008000; font-weight: bold">in</span> iterator)
            action(item);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Which can be used as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight" style="background: #f8f8f8;"><code data-lang="csharp"><span></span>IEnumerable&lt;<span style="color: #B00040">string</span>&gt; cities =
            <span style="color: #008000; font-weight: bold">new</span> <span style="color: #B00040">string</span>[] { <span style="color: #BA2121">&quot;Dublin&quot;</span>, <span style="color: #BA2121">&quot;Buenos Aires&quot;</span>, <span style="color: #BA2121">&quot;Madrid&quot;</span> };
cities.ApplyOperation(x=&gt;Console.WriteLine(<span style="color: #BA2121">&quot;City name: &quot;</span> + x));</code></pre>
</div>
</div>
<div class="paragraph">
<p>or simply</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight" style="background: #f8f8f8;"><code data-lang="csharp"><span></span><span style="color: #008000; font-weight: bold">new</span> <span style="color: #B00040">string</span>[] {
    <span style="color: #BA2121">&quot;Dublin&quot;</span>,
    <span style="color: #BA2121">&quot;Buenos Aires&quot;</span>,
    <span style="color: #BA2121">&quot;Madrid&quot;</span> }
    .ApplyOperation(
        x =&gt; Console.WriteLine(<span style="color: #BA2121">&quot;City name: &quot;</span> + x));</code></pre>
</div>
</div>
<div class="paragraph">
<p>which prints the following output:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/images/console.png" alt="console">
</div>
</div>
        </div>
        
          <p class="post-continue">
            <a href="/2011/08/22/apply-operation-in-collection-with-linq/#disqus_thread">Leave a comment</a>
          </p>

      </li>
    
      
      

      <li>
        <header class="post-header">
          <h1 class="post-title">
            <a class="post-link" href="/2011/08/13/unit-test-design-by-contract-part3/">Unit Test &amp; Design By Contract (Part III)</a>
          </h1>

          <p class="post-meta">Aug 13, 2011 • 
  
  
    
  
    
  
    
  
    
  
    
      <a href="/categories/test-driven-development/">test-driven development</a>,
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

  
  
    
      <a href="/categories/architecture/">architecture</a>,
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

  
  
    
  
    
  
    
  
    
  
    
  
    
      <a href="/categories/c/">c#</a>,
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

  
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <a href="/categories/unit-testing/">unit-testing</a>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

</p>
        </header>

        <div class="post-content">
          <div class="imageblock">
<div class="content">
<img src="/assets/images/dbc.png" alt="dbc" width="100%">
</div>
</div>
<div class="paragraph">
<p><em>This article is the last of three on <a href="/2011/08/08/unit-test-design-by-contract-part1/">Unit Testing and Design By Contract</a></em></p>
</div>
<div class="sect1">
<h2 id="testing_post_conditions_and_class_invariants">Testing Post Conditions and Class Invariants</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now we can test the two post conditions of the <code>Add</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight" style="background: #f8f8f8;"><code data-lang="csharp"><span></span><span style="color: #408080; font-style: italic">// Count is 0 before adding any items</span>
<span style="color: #408080; font-style: italic">// This is a post condition of the constructor</span>
<span style="color: #408080; font-style: italic">//and should be tested separately</span>
<span style="color: #7D9029">[Test]</span>
<span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">void</span> <span style="color: #0000FF">Add_PostCond_CountHasIncreasedByOne</span>()
{
    <span style="color: #B00040">var</span> stack = <span style="color: #008000; font-weight: bold">new</span> Stack(maximumNumberOfItemsAllowed: <span style="color: #666666">10</span>);
    stack.Add(<span style="color: #008000; font-weight: bold">new</span> <span style="color: #B00040">object</span>());
    Assert.AreEqual(<span style="color: #666666">1</span>,stack.Count);
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight" style="background: #f8f8f8;"><code data-lang="csharp"><span></span><span style="color: #408080; font-style: italic">// We use the &#39;Peek&#39; method to access the item on top of the stack.</span>
<span style="color: #408080; font-style: italic">// Pre and Post conditions of this method should be tested separately</span>
<span style="color: #7D9029">[Test]</span>
<span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">void</span> <span style="color: #0000FF">Add_PostCond_ItemIsOnTopOfTheStack</span>()
{
    <span style="color: #B00040">var</span> stack = <span style="color: #008000; font-weight: bold">new</span> Stack(maximumNumberOfItemsAllowed: <span style="color: #666666">10</span>);
    <span style="color: #B00040">var</span> firstItem = <span style="color: #008000; font-weight: bold">new</span> <span style="color: #B00040">object</span>();
    <span style="color: #B00040">var</span> secondItem = <span style="color: #008000; font-weight: bold">new</span> <span style="color: #B00040">object</span>();
    stack.Add(firstItem);
    stack.Add(secondItem);

    Assert.AreSame(secondItem, stack.Peek());
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>These types of test are probably the most commonly seen. Good Test Driven Development habits include asserting as few times as possible per tests, ideally one assertion only. The point is, as I mentioned earlier, error localization: if you only test one thing at a time, there has to be one test that explicitly exposes a bug.</p>
</div>
<div class="paragraph">
<p>There is still one more post condition to test: that no invariant rule of the class was violated by the <code>Add</code> method.</p>
</div>
<div class="sect2">
<h3 id="checking_class_invariants">Checking Class Invariants</h3>
<div class="paragraph">
<p>As mentioned earlier, Class Invariants are the rules that should always remain true after any method is executed on a class. The <code>Add</code> method is no exception, so we will have to test that class invariants were enforced when it executed.
We don’t want to repeat ourselves, so we will delegate to a reusable method called <code>CheckInvariants</code> that throws an exception if an Invariant rule has been broken.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight" style="background: #f8f8f8;"><code data-lang="csharp"><span></span><span style="color: #7D9029">[Test]</span>
<span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">void</span> <span style="color: #0000FF">Add_PostCond_InvariantsWereEnforced</span>()
{
    <span style="color: #408080; font-style: italic">//Arrange</span>
    <span style="color: #B00040">var</span> stack = <span style="color: #008000; font-weight: bold">new</span> MockRepository().PartialMock&lt;Stack&gt;(<span style="color: #666666">1</span>);
    stack.Expect(x=&gt;x.CheckInvariants());
    stack.Replay();

    <span style="color: #408080; font-style: italic">//Act</span>
    stack.Add(<span style="color: #008000; font-weight: bold">new</span> <span style="color: #B00040">object</span>());

    <span style="color: #408080; font-style: italic">//Assert</span>
    stack.VerifyAllExpectations();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This tests ensures that the method <code>CheckInvariants</code> has been invoked by the <code>Add</code> method. This type of tests, which verifies the interaction of methods rather than the resulting state of objects is known as Behavioural Tests.</p>
</div>
<div class="paragraph">
<p>The delegation itself is tested by using the <a href="http://ayende.com/blog/tags/rhino-mocks">Rhino Mocks</a> mocking library for .Net. In this case we create a Partial Mock <code>Stack</code> object. It is partial because we only want to mock one method (<code>CheckInvariants</code>) but we do want to execute a different one (<code>Add</code>) of the same class. We tell the partially mocked <code>Stack</code> that we are expecting the <code>CheckInvariants</code> method to be called later. After we explicitly invoked <code>Add</code>, we tell the stack to verify our expectation.
This verification will fail if the method was not invoked indirectly by <code>Add</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="how_public_are_the_class_invariants">How public are the Class Invariants?</h3>
<div class="paragraph">
<p>So the last thing is to test the Class Invariants. This is just another method called void <code>CheckInvariants()</code> of the class, but its access level deserves a bit of thought.</p>
</div>
<div class="paragraph">
<p>Let’s see what options we have:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>private: This method cannot be private because we need to write tests for it (as we did before)</p>
</li>
<li>
<p>protected: This would at least let us create the class <code>TestStack</code> that inherits the <code>Stack</code> class and create a public method that invokes <code>CheckInvariants</code>. See <a href="http://geekswithblogs.net/MattRobertsBlog/archive/2008/12/16/how-to-make-a-quotprotectedquot-method-available-for-quotpartialquot-mocking-and-again.aspx">this article</a> for more details on how to mock a protected method</p>
</li>
<li>
<p>internal: Internal methods can be invoked from within the assembly or an external assembly explicitly designated. This is the option chosen in this example</p>
</li>
<li>
<p>public: Not a bad option either in my opinion, any object can invoke this method anytime, which should not cause any inconvenient.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>And here are the two test for <code>CheckInvariants</code> itself</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight" style="background: #f8f8f8;"><code data-lang="csharp"><span></span><span style="color: #7D9029">[Test,ExpectedException(typeof(InvalidOperationException),</span>
<span style="color: #7D9029">    ExpectedMessage=&quot;Count cannnot be negative&quot;)]</span>
<span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">void</span> <span style="color: #0000FF">CheckInvariants_PostCond_CountIsNonNegative</span>()
{
    <span style="color: #B00040">var</span> stack = <span style="color: #008000; font-weight: bold">new</span> MockRepository().PartialMock&lt;Stack&gt;(<span style="color: #666666">1</span>);
    stack.Replay();
    stack.Count = -<span style="color: #666666">1</span>;

    stack.CheckInvariants();
}
<span style="color: #7D9029">[Test,</span>
<span style="color: #7D9029">ExpectedException(typeof(InvalidOperationException),</span>
<span style="color: #7D9029">    ExpectedMessage = &quot;Count cannot be greater than 7&quot;)]</span>
<span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">void</span> <span style="color: #0000FF">CheckInvariants_PostCond_CountIsLessThanMaximumAllowed</span>()
{
    <span style="color: #B00040">var</span> stack = <span style="color: #008000; font-weight: bold">new</span> MockRepository().PartialMock&lt;Stack&gt;(<span style="color: #666666">7</span>);
    stack.Replay();
    stack.Count = <span style="color: #666666">8</span>;

    stack.CheckInvariants();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And finally, here is the code for the <code>Stack</code> class, a class that honors its contract:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight" style="background: #f8f8f8;"><code data-lang="csharp"><span></span><span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">Stack</span>
{
    <span style="color: #008000; font-weight: bold">private</span> <span style="color: #B00040">int</span> _maximumNumberOfItemsAllowed;
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #0000FF">Stack</span>(<span style="color: #B00040">int</span> maximumNumberOfItemsAllowed)
    {
        _maximumNumberOfItemsAllowed = maximumNumberOfItemsAllowed;
    }

    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #B00040">int</span> Count { <span style="color: #008000; font-weight: bold">get</span>; <span style="color: #008000; font-weight: bold">protected</span> <span style="color: #008000; font-weight: bold">internal</span> <span style="color: #008000; font-weight: bold">set</span>; }

    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">void</span> <span style="color: #0000FF">Add</span>(<span style="color: #B00040">object</span> item)
    {
        <span style="color: #008000; font-weight: bold">if</span> (item == <span style="color: #008000; font-weight: bold">null</span>)
            <span style="color: #008000; font-weight: bold">throw</span> <span style="color: #008000; font-weight: bold">new</span> <span style="color: #0000FF">ArgumentNullException</span>(<span style="color: #BA2121">&quot;item&quot;</span>);

        <span style="color: #008000; font-weight: bold">if</span> (_maximumNumberOfItemsAllowed == Count)
            <span style="color: #008000; font-weight: bold">throw</span> <span style="color: #008000; font-weight: bold">new</span> <span style="color: #0000FF">InvalidOperationException</span>(
                <span style="color: #BA2121">&quot;Cannot add items when the stack is full.&quot;</span>);
        Count++;
        _array.Add(item);

        CheckInvariants();
    }

    <span style="color: #008000; font-weight: bold">private</span> IList _array = <span style="color: #008000; font-weight: bold">new</span> ArrayList();

    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #B00040">object</span> <span style="color: #0000FF">Peek</span>()
    {
        <span style="color: #008000; font-weight: bold">return</span> _array[Count - <span style="color: #666666">1</span>];
    }

    <span style="color: #008000; font-weight: bold">protected</span> <span style="color: #008000; font-weight: bold">internal</span> <span style="color: #008000; font-weight: bold">virtual</span> <span style="color: #008000; font-weight: bold">void</span> <span style="color: #0000FF">CheckInvariants</span>()
    {
        <span style="color: #008000; font-weight: bold">if</span> (Count &lt; <span style="color: #666666">0</span>)
            <span style="color: #008000; font-weight: bold">throw</span> <span style="color: #008000; font-weight: bold">new</span> <span style="color: #0000FF">InvalidOperationException</span>(<span style="color: #BA2121">&quot;Count cannnot be negative&quot;</span>);

       <span style="color: #008000; font-weight: bold">if</span> (Count &gt; _maximumNumberOfItemsAllowed)
            <span style="color: #008000; font-weight: bold">throw</span> <span style="color: #008000; font-weight: bold">new</span> <span style="color: #0000FF">InvalidOperationException</span>(<span style="color: #BA2121">&quot;Count cannot be greater than &quot;</span> + _maximumNumberOfItemsAllowed);
        }
    }</code></pre>
</div>
</div>
</div>
</div>
</div>
        </div>
        
          <p class="post-continue">
            <a href="/2011/08/13/unit-test-design-by-contract-part3/#disqus_thread">Leave a comment</a>
          </p>

      </li>
    
      
      

      <li>
        <header class="post-header">
          <h1 class="post-title">
            <a class="post-link" href="/2011/08/12/unit-test-design-by-contract-part2/">Unit Test &amp; Design By Contract (Part II)</a>
          </h1>

          <p class="post-meta">Aug 12, 2011 • 
  
  
    
  
    
  
    
  
    
  
    
      <a href="/categories/test-driven-development/">test-driven development</a>,
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

  
  
    
      <a href="/categories/architecture/">architecture</a>,
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

  
  
    
  
    
  
    
  
    
  
    
  
    
      <a href="/categories/c/">c#</a>,
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

  
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <a href="/categories/unit-testing/">unit-testing</a>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

</p>
        </header>

        <div class="post-content">
          <div class="imageblock">
<div class="content">
<img src="/assets/images/dbc.png" alt="dbc" width="100%">
</div>
</div>
<div class="paragraph">
<p><em>This article is the second of three on <a href="/2011/08/08/unit-test-design-by-contract-part1/">Unit Testing and Design By Contract</a></em></p>
</div>
<div class="sect1">
<h2 id="testing_pre_conditions">Testing Pre-Conditions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Our User Story contains two pre conditions, so we should write a test for each of them.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight" style="background: #f8f8f8;"><code data-lang="csharp"><span></span><span style="color: #7D9029">[Test, ExpectedException( typeof(ArgumentNullException))]</span>
<span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">void</span> <span style="color: #0000FF">Add_PreCond_ItemIsRequired</span>()
{
    <span style="color: #008000; font-weight: bold">new</span> <span style="color: #0000FF">Stack</span>(maximumNumberOfItemsAllowed: <span style="color: #666666">1</span>)
        .Add(<span style="color: #008000; font-weight: bold">null</span>);
}

<span style="color: #7D9029">[Test,</span>
<span style="color: #7D9029">ExpectedException(typeof(InvalidOperationException),</span>
<span style="color: #7D9029">    ExpectedMessage=&quot;Cannot add items when the stack is full.&quot;)]</span>
<span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">void</span> <span style="color: #0000FF">Add_PreCond_StackCantBeFull</span>()
{
    <span style="color: #008000; font-weight: bold">new</span> <span style="color: #0000FF">Stack</span>(maximumNumberOfItemsAllowed: <span style="color: #666666">0</span>)
        .Add(<span style="color: #008000; font-weight: bold">new</span> <span style="color: #B00040">object</span>());
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>These unit tests ensure that if any of the two pre conditions are not satisfied, the Supplier will not execute the method. To do so, it throws an error to the Client.</p>
</div>
<div class="paragraph">
<p>When we unit tests this behaviour, we assert that the Unit Tests will result in an exception being thrown, and we can additionally specify the type of the exception. These types of tests are also known as Unhappy Tests.</p>
</div>
<div class="sect2">
<h3 id="happy_case_the_n_1_pre_condition">Happy Case: The N + 1 Pre Condition</h3>
<div class="paragraph">
<p>How do you test that all pre conditions are met? Well, you could argue that is not needed, when testing post conditions we can assume that the method is executed, what means that we passed all pre condition checks.</p>
</div>
<div class="paragraph">
<p>Let’s suppose a new pre condition is added to the class, and that the developer forgets to write the Unit Test for it. Yes, all post-condition tests should now fail: there is a new pre condition in town. But this may not happen, what if the new pre condition was coincidentally met by all tests? For example, a new requirement that only allows us to add non empty strings to the stack may not be detected by any existing test if they already use non empty strings only.</p>
</div>
<div class="paragraph">
<p>There is another problem, related to error localization. In his brilliant book “Working Effectively with Legacy Code” Michael Feathers emphasizes that one of the benefits of good tests is that it helps us to easily localize problems. With a happy case, we do not want to test the outcome of a method. We want to check that if all pre requisites are satisfied, the method throws no error. This is the opposite scenario
of an unhappy case, that is, a happy case for pre conditions.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight" style="background: #f8f8f8;"><code data-lang="csharp"><span></span><span style="color: #7D9029">[Test]</span>
<span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">void</span> <span style="color: #0000FF">Add_PreCond_HappyCase</span>()
{
    <span style="color: #008000; font-weight: bold">new</span> <span style="color: #0000FF">Stack</span>(maximumNumberOfItemsAllowed: <span style="color: #666666">1</span>)
        .Add(<span style="color: #008000; font-weight: bold">new</span> <span style="color: #B00040">object</span>());
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that we are not doing any checking on this test. We simply want to pass all the validations for pre conditions. We are also not interested in testing the state of the stack after adding the item. In other words, we are not testing pre conditions either. We will do that in the nexdt part</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="coming_next">Coming Next:</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="/2011/08/13/unit-test-design-by-contract-part3">Testing Post Conditions and Class Invariants</a></p>
</div>
</div>
</div>
        </div>
        
          <p class="post-continue">
            <a href="/2011/08/12/unit-test-design-by-contract-part2/#disqus_thread">Leave a comment</a>
          </p>

      </li>
    
      
      

      <li>
        <header class="post-header">
          <h1 class="post-title">
            <a class="post-link" href="/2011/08/08/unit-test-design-by-contract-part1/">Unit Test &amp; Design By Contract (Part I)</a>
          </h1>

          <p class="post-meta">Aug 8, 2011 • 
  
  
    
  
    
  
    
  
    
  
    
      <a href="/categories/test-driven-development/">test-driven development</a>,
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

  
  
    
      <a href="/categories/architecture/">architecture</a>,
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

  
  
    
  
    
  
    
  
    
  
    
  
    
      <a href="/categories/c/">c#</a>,
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

  
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <a href="/categories/unit-testing/">unit-testing</a>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

</p>
        </header>

        <div class="post-content">
          <div class="imageblock">
<div class="content">
<img src="/assets/images/dbc.png" alt="dbc" width="100%">
</div>
</div>
<div class="paragraph">
<p>One of the most useful metaphors for organising software is the one of Design by Contract.</p>
</div>
<div class="paragraph">
<p>This technique, which was formalised by Bertrand Meyer in 1986 has its roots in previous ideas from Tony Hoare and Barbara Liskov.
In a nutshell, DBC equates the relationship of two pieces of software (i.e. two methods) to that of a <strong><em>Client</em></strong> and a <strong><em>Supplier</em></strong> in the business world,
both interacting with each other with clear rights and obligations, specified in a <strong><em>Contract</em></strong>.</p>
</div>
<div class="paragraph">
<p>In DBC, a <em>Supplier</em> can serve a request from a <em>Client</em> only if the latter satisfy the prerequisites or <strong><em>preconditions</em></strong> required by the <em>Supplier</em>.
The <em>Supplier</em> has an obligation to return a property as expected by the <em>Client</em>, the <strong><em>post-condition</em></strong>, once the request is served.</p>
</div>
<div class="paragraph">
<p>Additionally, a contract must specify certain properties that must remain true before and after the nteraction between <em>Client</em> and <em>Supplier</em>.
This obligation is known as a <strong><em>class invariant</em></strong>.</p>
</div>
<div class="sect2">
<h3 id="example">Example:</h3>
<div class="paragraph">
<p>A classic example to show DBC in practice is by building a data structure class, such as a Stack class. The rules of adding items to this structure are very clear:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Pre conditions</strong></p>
<div class="ulist">
<ul>
<li>
<p>An item must be provided to be added to the stack</p>
</li>
<li>
<p>There must be room in the stack to store the item</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Post conditions</strong></p>
<div class="ulist">
<ul>
<li>
<p>The number of items in the Stack increased by one</p>
</li>
<li>
<p>The item on top of the Stack is the one we just added</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Class Invariants</strong></p>
<div class="ulist">
<ul>
<li>
<p>The  number of items in the Stack  are greater or equal than zero</p>
</li>
<li>
<p>The number of items in the Stack are less or equal to the maximum size allowed</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect1">
<h2 id="who_checks_the_contract">Who checks the contract?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Typically, a method checks the pre-conditions of the contract only. If any of the pre conditions were not enforced by the Client of the method, the Supplier will not continue with the execution of the method since its result (and even its execution) can be unexpected. This is usually done by assertions at the beginning of a method: we assert that a precondition is true prior to executing the method, if the assertion is wrong, then the execution is suspended (an exception is thrown).</p>
</div>
<div class="paragraph">
<p>Post conditions and Class Invariant could, in theory, be checked in code too. However, this would lead to very long, unreadable and inefficient code. Also, in many cases testing the post-conditions is simply not viable. Remember the DBC metaphor and it will be clear that the party who is responsible for an obligation (the Supplier in this case) cannot be in charge of verifying that the obligation has been fulfilled (i.e. that the post condition is true).</p>
</div>
<div class="paragraph">
<p>Now, the Client could verify Post-Conditions and Class invariants, but we don’t know (and shouldn’t care) who will be the client of the method we are currently building. And if we are creating a Client of a method, our code requires the Supplier to do what is expected when we invoke its method. So where do we test Post conditions and Class invariants? You know the answer, in the Unit Tests.</p>
</div>
<div class="paragraph">
<p>Each of the six rules defined above can be converted into a unit test. This is what we’ll do next.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="a_structure_for_your_tests">A structure for your tests</h2>
<div class="sectionbody">
<div class="paragraph">
<p>But before writing the tests, let me suggest a naming convention for them. I like naming the tests using the following pattern:
%MethodName%<em>%ruleType%</em>%Description%</p>
</div>
<div class="paragraph">
<p>Where rule type is any of the three types of DBC rule: pre condition, post condition or class invariant
Here is the list of test we will write for this User Story, based on the previous pattern</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight" style="background: #f8f8f8;"><code data-lang="csharp"><span></span><span style="color: #7D9029">[Test]</span>
<span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">void</span> <span style="color: #0000FF">Add_PreCond_ItemIsRequired</span>()
    { <span style="color: #008000; font-weight: bold">throw</span> <span style="color: #008000; font-weight: bold">new</span> NotImplementedException(); }

<span style="color: #7D9029">[Test]</span>
<span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">void</span> <span style="color: #0000FF">Add_PreCond_StackCantBeFull</span>()
    { <span style="color: #008000; font-weight: bold">throw</span> <span style="color: #008000; font-weight: bold">new</span> NotImplementedException(); }

<span style="color: #7D9029">[Test]</span>
<span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">void</span> <span style="color: #0000FF">Add_PreCond_HappyCase</span>()
    { <span style="color: #008000; font-weight: bold">throw</span> <span style="color: #008000; font-weight: bold">new</span> NotImplementedException(); }

<span style="color: #7D9029">[Test]</span>
<span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">void</span> <span style="color: #0000FF">Add_PostCond_CountHasIncreasedByOne</span>()
    { <span style="color: #008000; font-weight: bold">throw</span> <span style="color: #008000; font-weight: bold">new</span> NotImplementedException(); }

<span style="color: #7D9029">[Test]</span>
<span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">void</span> <span style="color: #0000FF">Add_PostCond_ItemIsOnTopOfTheStack</span>()
    { <span style="color: #008000; font-weight: bold">throw</span> <span style="color: #008000; font-weight: bold">new</span> NotImplementedException(); }

<span style="color: #7D9029">[Test]</span>
<span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">void</span> <span style="color: #0000FF">Add_PostCond_InvariantsWereEnforced</span>()
    { <span style="color: #008000; font-weight: bold">throw</span> <span style="color: #008000; font-weight: bold">new</span> NotImplementedException(); }

<span style="color: #7D9029">[Test]</span>
<span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">void</span> <span style="color: #0000FF">CheckInvariants_PostCond_CountIsNonNegative</span>()
    { <span style="color: #008000; font-weight: bold">throw</span> <span style="color: #008000; font-weight: bold">new</span> NotImplementedException(); }

<span style="color: #7D9029">[Test]</span>
<span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">void</span> <span style="color: #0000FF">CheckInvariants_PostCond_CountIsLessThanMaximumAllowed</span>()
    { <span style="color: #008000; font-weight: bold">throw</span> <span style="color: #008000; font-weight: bold">new</span> NotImplementedException(); }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <em>Happy Case</em> test was not in the list, and there are two tests for a method called <code>Check Invariants</code>. We will look into these tests in detail later.
Typically you would put these methods in a class called <code>StackTests</code>. However, if you have a method that requires a large number of tests, you can have one test class per method instead.
Your test class would be named <code>Stack_AddTests</code> and the test names would be, for example, <code>PreCond_ItemIsRequired</code>.</p>
</div>
<div class="sect2">
<h3 id="generating_documentation_from_your_tests">Generating Documentation from your Tests</h3>
<div class="paragraph">
<p>By following this structure for tests and fixtures, we can enrich the documentation generated from our code.
This requires customisation of tools like <a href="http://ndoc.sourceforge.net">NDoc</a> or <a href="http://sandcastle.codeplex.com/">Sandcastle</a>.
The exact implementation is outside of the scope of this article, but I will post it at some point. The idea is to parse the name of Fixtures and Tests to append pre and post conditions to their relative methods, in a readable way.</p>
</div>
<div class="paragraph">
<p>One caveat I have with this idea is that you have to remember that you are not using the “true” code for generating the docs, but the names of the apis. This means that your documentation will be as accurate as the name of your tests.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="coming_next">Coming next:</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="/2011/08/12/unit-test-design-by-contract-part2">Checking Pre Conditions</a></p>
</div>
</div>
</div>
        </div>
        
          <p class="post-continue">
            <a href="/2011/08/08/unit-test-design-by-contract-part1/#disqus_thread">Leave a comment</a>
          </p>

      </li>
    
      
      

      <li>
        <header class="post-header">
          <h1 class="post-title">
            <a class="post-link" href="/2011/03/14/notes-from-qcon-london-2012/">Notes From Qcon London 2012</a>
          </h1>

          <p class="post-meta">Mar 14, 2011 • 
  
  
    
  
    
  
    
  
    
      <a href="/categories/news/">news</a>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

</p>
        </header>

        <div class="post-content">
          <div class="paragraph">
<p><em>Did you know Facebook is n ordinary single-threaded PHP website? How complex do you think Twitter’s business logic model is? Do you know how Nokia is preparing to scale Ovi once (if) their Microsoft deal is agreed?</em></p>
</div>
<div class="paragraph">
<p>You may already be familiar with InfoQ, but if you are not, I recommend you to take a look at it at <a href="http://www.infoq.com">www.infoq.com</a>. InfoQ is an online community focused on innovation in enterprise software development. On a daily basis, they deliver high quality articles for IT communities such as .Net, Java, SOA, Ruby and Agile among others._</p>
</div>
<div class="paragraph">
<p>QCon is the annual event organised by InfoQ, where experts in each of these diverse areas provide an update on the latest lessons learned, discoveries and challenges ahead. I am just back from QCon 2011 in London, where I had the opportunity to listen to some of these experiences and to get an idea of what is being done in other companies and countries.</p>
</div>
<div class="paragraph">
<p>Is not often that you get to talk to the people behind architectures such as Twitter, Facebook, Nokia and Guardian.co.uk among others, so I want to share some of the good stuff of QCon here.</p>
</div>
<div class="paragraph">
<p>Today I’m starting with an overview of the chats I assisted to on the first of the three days of conference . I can’t guarantee I’ll remember (or I even grasped) all I listened to, but I can at least give you resources and point you to the right documentation. I also plan to write detailed posts on a few topics I found most interesting.</p>
</div>
<div class="sect1">
<h2 id="day_1">Day 1</h2>
<div class="sectionbody">
<div class="paragraph">
<p>All presentations were held during three days, and categorised into five areas or tracks per day. Unfortunately there is only one me so I had to select carefully …</p>
</div>
<div class="paragraph">
<p>One of the tracks of Day 1 was <strong>“Enterprise Agile Transformation”</strong>.</p>
</div>
<div class="paragraph">
<p>Being an Agile geek, I had to force myself to diversify, which was as difficult as getting a dog to eat a balanced diet.</p>
</div>
<div class="sect2">
<h3 id="scaling_lean_agile_large_multisite_or_offshore_delivery">Scaling Lean &amp; Agile: Large, Multisite or Offshore Delivery</h3>
<div class="paragraph">
<p>Craig Larman has a vast experience on implementing SCRUM in very large-scale project. With large I mean 500-1500 person, multisite teams with clients such as Xeror &amp; Alcatel-Lucent. From these experiences he shared lessons learned, patterns and anti patterns on how to adopt and maintain Agile projects with multi hundred person teams, both co located and off shore.</p>
</div>
<div class="paragraph">
<p>Larman is also the author of the books <em>“Thinking &amp; Organizational Tools”</em> and <em>“Practices for Scaling Lean &amp; Agile Development”</em></p>
</div>
<div class="paragraph">
<p>This was the key note of the day what means that a bit of time is wasted on bad jokes, but it gave us an idea on how we can keep a high level of communication and transparency despite teams being very large or non- co-located.</p>
</div>
</div>
<div class="sect2">
<h3 id="the_invisible_computer_lab">The Invisible Computer Lab</h3>
<div class="paragraph">
<p>I am still not sure why I choose this presentation, but it turned out very interesting. Fraser Speirs is an iPhone developer who is also the head of Computer at a School in Greenok, Scotland . He told us how his school provided all children with iPads as the main learning channel. He also shared with us what where the students, teachers and parents reactions, his view of the overall results of the iPad implementation, and how he foresees the future of technology in the classroom.</p>
</div>
</div>
<div class="sect2">
<h3 id="contracts_collaboration_in_agile_offshore_outsourced_development">Contracts &amp; Collaboration in Agile “Offshore” Outsourced Development</h3>
<div class="paragraph">
<p>Again Craig Larman (I told you I struggled to diversify this day!) deep-dive on how to scale Agile, in particular with off shore outsourced teams. There were a few useful tips and tricks on how to deal with offsite teams without losing the high level of transparency required by Agile methodologies. From cultural differences to contract-model choices, this was no high level, abstract Agile talk, but a very hand on and pragmatic one instead, including tips as low levels as what video chat software to use in daily SCRUMs .</p>
</div>
</div>
<div class="sect2">
<h3 id="bringing_developers_and_testers_closer_together_with_visual_studio">Bringing developers and testers closer together with Visual Studio</h3>
<div class="paragraph">
<p>The “Solutions” track, the only one that run over the three days, was the showroom for commercial products and frameworks. In this context, Gile Davies from Microsoft UK presented Test Manager, a new application for collaboration between testers and developers.</p>
</div>
<div class="paragraph">
<p>I have to say I was extremely impressed by this tool, which is an extension of Team Foundation Server. The amount of help it provides to testers and developers during the lifecycle of bugs is what surprised me:</p>
</div>
<div class="paragraph">
<p>-Testers can record their UI interaction within Windows and store them (okay this is not all that impressive yet…)</p>
</div>
<div class="paragraph">
<p>-They can modularised these UI steps into logical blocks (e.g. “Find a book to buy”, “Add it to the cart with IE 7.0”, ”Cancel order using keyword only”, etc)</p>
</div>
<div class="paragraph">
<p>-All test steps gets auto appended to Bug description.</p>
</div>
<div class="paragraph">
<p>-Developers can click on the logical block that failed. They can even debug the problem as of the execution performed by the tester (yes!, it saves the entire state of the test that failed, so developers and tester are always talking of the same environment!)</p>
</div>
<div class="paragraph">
<p>-It can even take automatic snapshot of cloud environments (we are talking Windows Azure only, of course)</p>
</div>
</div>
<div class="sect2">
<h3 id="complex_event_processing_dsl_for_high_frequency_trading">Complex Event Processing: DSL for High Frequency Trading</h3>
<div class="paragraph">
<p>Richard Tibbets presented the system his company build, StreamBase. It is an engine for Complex Event Processing Domain Specific Languages, complied into JVM code. The common perception of DSLs is that they are very expressive but that they cannot perform in scenarios where speed is at premium, like front-office trading applications.</p>
</div>
<div class="paragraph">
<p>Unfortunately, I wasn’t able to dissipate my objections to DSLs. Ironically, despite all the talk about speed I felt this chat so slow it was never ending.</p>
</div>
</div>
<div class="sect2">
<h3 id="where_did_my_architecture_go_preserving_software_architecture_in_its_implementation">Where Did My Architecture Go? Preserving software architecture in its implementation</h3>
<div class="paragraph">
<p>Agile systems are evolutionary, which means that the design of the system is not fully detailed up front. Instead, it “emerges” from a series of cycles of iterative development. Now for those who are not used to evolutionary design, this may sound like anarchy or worse, like no design at all.</p>
</div>
<div class="paragraph">
<p>Eoin Woods did a very convincing walk through a set of tools that allow system to generate their representation from their implementation. This allows teams to keep their architectural design updated, so that the big picture is always clear as the software evolves. Some of the tools I knew already, but there were a few others that I’d really like to try in my next project. The tools demonstrated included support for .Net, Java and C++ technologies.</p>
</div>
</div>
<div class="sect2">
<h3 id="more_may_follow">More may follow…</h3>
<div class="paragraph">
<p>As I mentioned earlier, I will try to follow this post with other two with the presentation I’ve attended to on Day 2 and 3. After that, I will write a detailed post on some of the talks I’ve found most interesting.</p>
</div>
</div>
</div>
</div>
        </div>
        
          <p class="post-continue">
            <a href="/2011/03/14/notes-from-qcon-london-2012/#disqus_thread">Leave a comment</a>
          </p>

      </li>
    
  </ul>

  
  <div class="pagination">
    
      <a class="previous" href="/posts/3/">&laquo; Older</a>
    

    
      <a class="next" href="/">Newer &raquo;</a>
    
  </div>



</div>

      </div>
    </main>

    <footer class="site-footer">

  <div class="wrapper">

    <p>
      

&copy; sebastian slutzky - Powered by <a href="https://jekyllrb.com">Jekyll</a> &amp; <a href="https://github.com/yous/whiteglass">whiteglass</a> - Subscribe via <a href="http://youarewhatyoucode/feed.xml">RSS</a>

    </p>

  </div>

</footer>


  </body>

</html>
