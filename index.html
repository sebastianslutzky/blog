<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  
  
  <title>you are what you code</title>
  <meta name="description" content="a pretentiusly simple blog, with a series of coherent tech rambles...">
  

  <link rel="stylesheet" href="/blog/assets/main.css">
  <link rel="canonical" href="http://youarewhatyoucode/blog/">
  
  
  <link rel="alternate" type="application/rss+xml" title="you are what you code" href="http://youarewhatyoucode/blog/feed.xml">

  

  
  <meta name="twitter:card" content="summary">
  
  <meta name="twitter:title" content="you are what you code">
  <meta name="twitter:description" content="a pretentiusly simple blog, with a series of coherent tech rambles...">
  
  

  <script type="text/javascript">
  WebFontConfig = {
    google: { families: [ 'Bitter:400,700,400italic:latin' ] }
  };
  (function() {
    var wf = document.createElement('script');
    wf.src = ('https:' == document.location.protocol ? 'https' : 'http') +
      '://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js';
    wf.type = 'text/javascript';
    wf.async = 'true';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(wf, s);
  })();
</script>

  

</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/blog/">you are what you code</a>

    <nav class="site-nav">
      
        
        <a class="page-link" href="https://ie.linkedin.com/in/sebastianslutzky">About</a>
      
        
        <a class="page-link" href="/blog/archives/">Archives</a>
      
        
        <a class="page-link" href="https://github.com/sebastianslutzky">GitHub</a>
      
    </nav>

  </div>

</header>


    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <div class="home">

  

  

  <ul class="post-list">
    
      
      

      <li>
        <header class="post-header">
          <h1 class="post-title">
            <a class="post-link" href="/blog/2015/11/24/take-control-of-your-api-aspects/">Take control of your Web API aspects</a>
          </h1>

          <p class="post-meta">Nov 24, 2015</p>
        </header>

        <div class="post-content">
          Excerpt goes here.
        </div>
        
      </li>
    
      
      

      <li>
        <header class="post-header">
          <h1 class="post-title">
            <a class="post-link" href="/blog/2011/10/29/naked-objects-is-opensource/">Nake Objects framework is now open sourced</a>
          </h1>

          <p class="post-meta">Oct 29, 2011</p>
        </header>

        <div class="post-content">
          <h1>Nake Objects framework is now open sourced</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The Naked Objects framework for .Net is now open sourced under Microsoft Public License.</p>
</div>
<div class="paragraph">
<p>The projects is now hosted at <a href="http://nakedobjects.codeplex.com/">Codeplex</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="hola">hola</h2>
<div class="sectionbody">
<div class="paragraph">
<p>asfdasfdas</p>
</div>
<div class="sect2">
<h3 id="mundo">mundo</h3>
<div class="paragraph">
<p>safasf</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="como">como</h2>
<div class="sectionbody">
<div class="paragraph">
<p>asfafsd
sfd
=== estas</p>
</div>
<div class="paragraph">
<p>asdfas</p>
</div>
<div class="paragraph">
<p>You can download the framework from there or in Visual Studio, from NuGet</p>
</div>
</div>
</div>
        </div>
        
      </li>
    
      
      

      <li>
        <header class="post-header">
          <h1 class="post-title">
            <a class="post-link" href="/blog/2011/08/22/apply-operation-in-collection-with-linq/">Apply an operation to a collection with LinQ</a>
          </h1>

          <p class="post-meta">Aug 22, 2011</p>
        </header>

        <div class="post-content">
          <h1>Apply an operation to a collection with LinQ</h1>
<div class="paragraph">
<p>These days, it is unusual to write an implementation of the Iterator pattern. Most of the modern languages included a library with a set of aggregate objects that follow this pattern as defined in the <a href="https://www.amazon.com/Design-Patterns-Elements-Reusable-Object-Oriented/dp/0201633612">Gang of Four book</a>.</p>
</div>
<div class="paragraph">
<p>In .Net, these objects are in the System.Collections namespace and they include classes such as Lists, Queues, Dictionaries, and also their specialised strongly typed (Generic) version.</p>
</div>
<div class="paragraph">
<p>The Gang Of Four defines two types of iterators: External and Internal. The External requires the client to traverse the items (by looping through the items until the end of the iterator). In contrast to this, the internal iterator delegates this process to a Traverse mix-in class that can be extended and customised.</p>
</div>
<div class="paragraph">
<p>I was looking for something similar to the internal iterator in .Net. That is, a generic way of passing an operation to a collection that would apply it to each of its items. None of the LinQ extension methods for collections seemed to do this, so I wrote one:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="csharp">public static class Extensions
{
    public static void ApplyOperation&lt;T&gt;
                (this IEnumerable&lt;T&gt; iterator,
                Action&lt;T&gt; action)
    {
        foreach (var item in iterator)
            action(item);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Which can be used as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="csharp">IEnumerable&lt;string&gt; cities =
            new string[] { "Dublin", "Buenos Aires", "Madrid" };
cities.ApplyOperation(x=&gt;Console.WriteLine("City name: " + x));</code></pre>
</div>
</div>
<div class="paragraph">
<p>or simply</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="csharp">new string[] {
    "Dublin",
    "Buenos Aires",
    "Madrid" }
    .ApplyOperation(
        x =&gt; Console.WriteLine("City name: " + x));</code></pre>
</div>
</div>
<div class="paragraph">
<p>which prints the following output:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/console.png" alt="console">
</div>
</div>
        </div>
        
      </li>
    
      
      

      <li>
        <header class="post-header">
          <h1 class="post-title">
            <a class="post-link" href="/blog/2011/08/13/unit-test-design-by-contract-part3/">Unit testing with Design By Contract (part 3)</a>
          </h1>

          <p class="post-meta">Aug 13, 2011</p>
        </header>

        <div class="post-content">
          <h1>Unit testing with Design By Contract (part 3)</h1>
<div id="preamble">
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<img src="/images/dbc.png" alt="dbc" width="100%">
</div>
</div>
<div class="paragraph">
<p><em>This article is the last of three on <a href="http://sebastianslutzky.com/2011/08/08/unit-testing-with-design-by-contract/">Unit Testing and Design By Contract</a></em></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="testing_post_conditions_and_class_invariants">Testing Post Conditions and Class Invariants</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now we can test the two post conditions of the <code>Add</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="csharp">// Count is 0 before adding any items
// This is a post condition of the constructor
//and should be tested separately
[Test]
public void Add_PostCond_CountHasIncreasedByOne()
{
    var stack = new Stack(maximumNumberOfItemsAllowed: 10);
    stack.Add(new object());
    Assert.AreEqual(1,stack.Count);
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="csharp">// We use the 'Peek' method to access the item on top of the stack.
// Pre and Post conditions of this method should be tested separately
[Test]
public void Add_PostCond_ItemIsOnTopOfTheStack()
{
    var stack = new Stack(maximumNumberOfItemsAllowed: 10);
    var firstItem = new object();
    var secondItem = new object();
    stack.Add(firstItem);
    stack.Add(secondItem);

    Assert.AreSame(secondItem, stack.Peek());
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>These types of test are probably the most commonly seen. Good Test Driven Development habits include asserting as few times as possible per tests, ideally one assertion only. The point is, as I mentioned earlier, error localization: if you only test one thing at a time, there has to be one test that explicitly exposes a bug.</p>
</div>
<div class="paragraph">
<p>There is still one more post condition to test: that no invariant rule of the class was violated by the <code>Add</code> method.</p>
</div>
<div class="sect2">
<h3 id="checking_class_invariants">Checking Class Invariants</h3>
<div class="paragraph">
<p>As mentioned earlier, Class Invariants are the rules that should always remain true after any method is executed on a class. The <code>Add</code> method is no exception, so we will have to test that class invariants were enforced when it executed.
We don’t want to repeat ourselves, so we will delegate to a reusable method called <code>CheckInvariants</code> that throws an exception if an Invariant rule has been broken.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="csharp">[Test]
public void Add_PostCond_InvariantsWereEnforced()
{
    //Arrange
    var stack = new MockRepository().PartialMock&lt;Stack&gt;(1);
    stack.Expect(x=&gt;x.CheckInvariants());
    stack.Replay();

    //Act
    stack.Add(new object());

    //Assert
    stack.VerifyAllExpectations();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This tests ensures that the method <code>CheckInvariants</code> has been invoked by the <code>Add</code> method. This type of tests, which verifies the interaction of methods rather than the resulting state of objects is known as Behavioural Tests.</p>
</div>
<div class="paragraph">
<p>The delegation itself is tested by using the <a href="http://ayende.com/blog/tags/rhino-mocks">Rhino Mocks</a> mocking library for .Net. In this case we create a Partial Mock <code>Stack</code> object. It is partial because we only want to mock one method (<code>CheckInvariants</code>) but we do want to execute a different one (<code>Add</code>) of the same class. We tell the partially mocked <code>Stack</code> that we are expecting the <code>CheckInvariants</code> method to be called later. After we explicitly invoked <code>Add</code>, we tell the stack to verify our expectation.
This verification will fail if the method was not invoked indirectly by <code>Add</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="how_public_are_the_class_invariants">How public are the Class Invariants?</h3>
<div class="paragraph">
<p>So the last thing is to test the Class Invariants. This is just another method called void <code>CheckInvariants()</code> of the class, but its access level deserves a bit of thought.</p>
</div>
<div class="paragraph">
<p>Let’s see what options we have:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>private: This method cannot be private because we need to write tests for it (as we did before)</p>
</li>
<li>
<p>protected: This would at least let us create the class <code>TestStack</code> that inherits the <code>Stack</code> class and create a public method that invokes <code>CheckInvariants</code>. See <a href="http://geekswithblogs.net/MattRobertsBlog/archive/2008/12/16/how-to-make-a-quotprotectedquot-method-available-for-quotpartialquot-mocking-and-again.aspx">this article</a> for more details on how to mock a protected method</p>
</li>
<li>
<p>internal: Internal methods can be invoked from within the assembly or an external assembly explicitly designated. This is the option chosen in this example</p>
</li>
<li>
<p>public: Not a bad option either in my opinion, any object can invoke this method anytime, which should not cause any inconvenient.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>And here are the two test for <code>CheckInvariants</code> itself</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="csharp">[Test,ExpectedException(typeof(InvalidOperationException),
    ExpectedMessage="Count cannnot be negative")]
public void CheckInvariants_PostCond_CountIsNonNegative()
{
    var stack = new MockRepository().PartialMock&lt;Stack&gt;(1);
    stack.Replay();
    stack.Count = -1;

    stack.CheckInvariants();
}
[Test,
ExpectedException(typeof(InvalidOperationException),
    ExpectedMessage = "Count cannot be greater than 7")]
public void CheckInvariants_PostCond_CountIsLessThanMaximumAllowed()
{
    var stack = new MockRepository().PartialMock&lt;Stack&gt;(7);
    stack.Replay();
    stack.Count = 8;

    stack.CheckInvariants();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And finally, here is the code for the <code>Stack</code> class, a class that honors its contract:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="csharp">public class Stack
{
    private int _maximumNumberOfItemsAllowed;
    public Stack(int maximumNumberOfItemsAllowed)
    {
        _maximumNumberOfItemsAllowed = maximumNumberOfItemsAllowed;
    }

    public int Count { get; protected internal set; }

    public void Add(object item)
    {
        if (item == null)
            throw new ArgumentNullException("item");

        if (_maximumNumberOfItemsAllowed == Count)
            throw new InvalidOperationException(
                "Cannot add items when the stack is full.");
        Count++;
        _array.Add(item);

        CheckInvariants();
    }

    private IList _array = new ArrayList();

    public object Peek()
    {
        return _array[Count - 1];
    }

    protected internal virtual void CheckInvariants()
    {
        if (Count &lt; 0)
            throw new InvalidOperationException("Count cannnot be negative");

       if (Count &gt; _maximumNumberOfItemsAllowed)
            throw new InvalidOperationException("Count cannot be greater than " + _maximumNumberOfItemsAllowed);
        }
    }</code></pre>
</div>
</div>
</div>
</div>
</div>
        </div>
        
      </li>
    
      
      

      <li>
        <header class="post-header">
          <h1 class="post-title">
            <a class="post-link" href="/blog/2011/08/12/unit-test-design-by-contract-part2/">Unit testing with Design By Contract (part 2)</a>
          </h1>

          <p class="post-meta">Aug 12, 2011</p>
        </header>

        <div class="post-content">
          <h1>Unit testing with Design By Contract (part 2)</h1>
<div id="preamble">
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<img src="/images/dbc.png" alt="dbc" width="100%">
</div>
</div>
<div class="paragraph">
<p><em>This article is the second of three on <a href="http://sebastianslutzky.com/2011/08/08/unit-testing-with-design-by-contract/">Unit Testing and Design By Contract</a></em></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="testing_post_conditions_and_class_invariants">Testing Post Conditions and Class Invariants</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Our User Story contains two pre conditions, so we should write a test for each of them.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="csharp">[Test, ExpectedException( typeof(ArgumentNullException))]
public void Add_PreCond_ItemIsRequired()
{
    new Stack(maximumNumberOfItemsAllowed: 1)
        .Add(null);
}

[Test,
ExpectedException(typeof(InvalidOperationException),
    ExpectedMessage="Cannot add items when the stack is full.")]
public void Add_PreCond_StackCantBeFull()
{
    new Stack(maximumNumberOfItemsAllowed: 0)
        .Add(new object());
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>These unit tests ensure that if any of the two pre conditions are not satisfied, the Supplier will not execute the method. To do so, it throws an error to the Client.</p>
</div>
<div class="paragraph">
<p>When we unit tests this behaviour, we assert that the Unit Tests will result in an exception being thrown, and we can additionally specify the type of the exception. These types of tests are also known as Unhappy Tests.</p>
</div>
<div class="sect2">
<h3 id="happy_case_the_n_1_pre_condition">Happy Case: The N + 1 Pre Condition</h3>
<div class="paragraph">
<p>How do you test that all pre conditions are met? Well, you could argue that is not needed, when testing post conditions we can assume that the method is executed, what means that we passed all pre condition checks.</p>
</div>
<div class="paragraph">
<p>Let’s suppose a new pre condition is added to the class, and that the developer forgets to write the Unit Test for it. Yes, all post-condition tests should now fail: there is a new pre condition in town. But this may not happen, what if the new pre condition was coincidentally met by all tests? For example, a new requirement that only allows us to add non empty strings to the stack may not be detected by any existing test if they already use non empty strings only.</p>
</div>
<div class="paragraph">
<p>There is another problem, related to error localization. In his brilliant book “Working Effectively with Legacy Code” Michael Feathers emphasizes that one of the benefits of good tests is that it helps us to easily localize problems. With a happy case, we do not want to test the outcome of a method. We want to check that if all pre requisites are satisfied, the method throws no error. This is the opposite scenario
of an unhappy case, that is, a happy case for pre conditions.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="csharp">[Test]
public void Add_PreCond_HappyCase()
{
    new Stack(maximumNumberOfItemsAllowed: 1)
        .Add(new object());
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that we are not doing any checking on this test. We simply want to pass all the validations for pre conditions. We are also not interested in testing the state of the stack after adding the item. In other words, we are not testing pre conditions either. We will do that in the nexdt part</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="coming_next">Coming Next:</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://sebastianslutzky.wordpress.com/2011/08/13/testing-post-conditions-and-class-invariants/">Testing Post Conditions and Class Invariants</a></p>
</div>
</div>
</div>
        </div>
        
      </li>
    
  </ul>

  
  <div class="pagination">
    
      <a class="previous" href="/blog/posts/2/">&laquo; Older</a>
    

    
  </div>



</div>

      </div>
    </main>

    <footer class="site-footer">

  <div class="wrapper">

    <p>
      

&copy; sebastian slutzky - Powered by <a href="https://jekyllrb.com">Jekyll</a> &amp; <a href="https://github.com/yous/whiteglass">whiteglass</a> - Subscribe via <a href="http://youarewhatyoucode/blog/feed.xml">RSS</a>

    </p>

  </div>

</footer>


  </body>

</html>
